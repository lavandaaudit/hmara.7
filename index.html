<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IBONARIUM · CLOUD BAROMETER · MOBILE EDITION</title>
    <style>
        :root {
            --bg: #05080a;
            --accent: #00ffcc;
            --secondary: #00ccff;
            --danger: #ff3366;
            --warning: #ffcc00;
            --glass: rgba(10, 20, 30, 0.95);
            --border: rgba(0, 255, 204, 0.3);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background: #000;
            color: #d0f0ff;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
            min-height: 100vh;
        }

        #bg-effect {
            position: fixed;
            inset: 0;
            z-index: 1;
            background: radial-gradient(circle at top left, #0a1b22 0%, #000 70%);
        }

        /* INSTRUMENT HUB */
        #cloud-barometer {
            position: relative;
            margin: 15px auto;
            width: 92%;
            max-width: 320px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 14px;
            backdrop-filter: blur(20px);
            z-index: 100;
            display: flex;
            flex-direction: column;
            padding: 15px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.9);
        }

        @media (min-width: 768px) {
            #cloud-barometer {
                position: fixed;
                top: 15px;
                left: 15px;
                margin: 0;
            }
        }

        .inst-header {
            font-size: 10px;
            letter-spacing: 3px;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 12px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 6px;
            text-align: center;
            font-weight: bold;
        }

        #alert-banner {
            display: none;
            background: rgba(255, 51, 102, 0.15);
            border: 1px solid var(--danger);
            color: var(--danger);
            font-size: 9px;
            padding: 5px;
            margin-bottom: 10px;
            border-radius: 4px;
            text-align: center;
            animation: pulse-alert 1.5s infinite;
        }

        @keyframes pulse-alert {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .viz-container {
            width: 100%;
            height: 180px;
            background: #030608;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 12px;
            position: relative;
            border: 1px solid rgba(0, 255, 204, 0.1);
        }

        canvas#cloud-engine {
            width: 100%;
            height: 100%;
        }

        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-bottom: 12px;
        }

        .data-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 5px;
            border-left: 2px solid var(--secondary);
        }

        .data-box label {
            display: block;
            font-size: 7px;
            opacity: 0.6;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .data-box b {
            font-size: 12px;
            color: #fff;
        }

        .alt-scanner {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin: 10px 0;
        }

        .alt-layer {
            height: 16px;
            background: rgba(0, 204, 255, 0.05);
            border: 1px solid rgba(0, 204, 255, 0.1);
            position: relative;
            border-radius: 3px;
        }

        .alt-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
            width: 0%;
            transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .alt-label {
            position: absolute;
            left: 6px;
            top: 3px;
            font-size: 7px;
            color: #fff;
            pointer-events: none;
            text-shadow: 0 0 2px #000;
        }

        .city-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .city-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--accent);
            font-size: 9px;
            padding: 8px 2px;
            /* Bigger touch area for mobile */
            cursor: pointer;
            border-radius: 4px;
            text-align: center;
            transition: 0.3s;
        }

        .city-btn.active {
            background: var(--accent);
            color: #000;
            box-shadow: 0 0 10px var(--accent);
        }

        #system-status {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 255, 204, 0.05);
            border: 1px dashed var(--border);
            border-radius: 6px;
        }

        .status-title {
            font-size: 8px;
            color: var(--accent);
            margin-bottom: 5px;
            opacity: 0.8;
        }

        #status-text {
            font-size: 10px;
            line-height: 1.4;
            color: #c0eaff;
        }

        #sys-log {
            font-size: 7px;
            color: var(--accent);
            opacity: 0.5;
            height: 35px;
            margin-top: 15px;
            display: flex;
            flex-direction: column-reverse;
            overflow: hidden;
            border-top: 1px solid var(--border);
            padding-top: 8px;
        }

        .mini-compass {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 45px;
            height: 45px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <div id="bg-effect"></div>
    <div id="cloud-barometer">
        <div class="inst-header">IBONARIUM · CLOUD BAROMETER</div>

        <div id="alert-banner">!! УВАГА: КРИТИЧНИЙ ВІТЕР !!</div>

        <div class="viz-container">
            <canvas id="cloud-engine"></canvas>
            <canvas id="mini-compass" class="mini-compass"></canvas>
        </div>

        <div class="data-grid">
            <div class="data-box"><label>CITY</label><b id="cityName">---</b></div>
            <div class="data-box"><label>TEMP</label><b id="temp">--</b>°C</div>
            <div class="data-box"><label>HUMID</label><b id="hum">--</b>%</div>
            <div class="data-box"><label>WIND</label><b id="windSpd">--</b> m/s</div>
        </div>

        <div class="alt-scanner">
            <div class="alt-layer">
                <div class="alt-fill" id="coverHigh"></div><span class="alt-label">HIGH (10km)</span>
            </div>
            <div class="alt-layer">
                <div class="alt-fill" id="coverMid"></div><span class="alt-label">MID (5km)</span>
            </div>
            <div class="alt-layer">
                <div class="alt-fill" id="coverLow"></div><span class="alt-label">LOW (2km)</span>
            </div>
        </div>

        <div id="system-status">
            <div class="status-title">> АНАЛІЗ СТАНУ СИСТЕМИ</div>
            <div id="status-text">Синхронізація з метео-супутниками...</div>
        </div>

        <div class="city-grid" id="cityContainer"></div>
        <div id="sys-log"></div>
    </div>

    <script>
        const cities = [
            { name: "Kyiv", lat: 50.45, lon: 30.52 }, { name: "Lviv", lat: 49.83, lon: 24.02 }, { name: "Odesa", lat: 46.48, lon: 30.72 },
            { name: "N.York", lat: 40.71, lon: -74.01 }, { name: "B. Aires", lat: -34.61, lon: -58.38 }, { name: "London", lat: 51.51, lon: -0.13 },
            { name: "Paris", lat: 48.85, lon: 2.35 }, { name: "Dubai", lat: 25.20, lon: 55.27 }, { name: "Tokyo", lat: 35.68, lon: 139.69 },
            { name: "Singapore", lat: 1.35, lon: 103.81 }, { name: "Vienna", lat: 48.20, lon: 16.37 }, { name: "Lagos", lat: 6.52, lon: 3.37 }
        ];

        let weather = { cover: 0, low: 0, mid: 0, high: 0, hum: 50, wind: 0, dir: 0 };
        const cityBox = document.getElementById('cityContainer');

        cities.forEach((c, i) => {
            const btn = document.createElement('div');
            btn.className = 'city-btn' + (i === 0 ? ' active' : '');
            btn.textContent = c.name;
            btn.onclick = () => {
                document.querySelectorAll('.city-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updateWeather(c);
            };
            cityBox.appendChild(btn);
        });

        const canvas = document.getElementById('cloud-engine');
        const ctx = canvas.getContext('2d');
        const cmpCanvas = document.getElementById('mini-compass');
        const cmpCtx = cmpCanvas.getContext('2d');

        function resize() {
            const w = canvas.parentElement.clientWidth;
            const h = canvas.parentElement.clientHeight;
            canvas.width = w; canvas.height = h;
            cmpCanvas.width = 45; cmpCanvas.height = 45;
        }
        window.onresize = resize; resize();

        function draw(t) {
            if (!canvas.width) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const time = t * 0.0006, dir = weather.dir * Math.PI / 180;
            const g = ctx.createLinearGradient(0, 0, 0, canvas.height);
            g.addColorStop(0, '#0a1a20'); g.addColorStop(1, '#000');
            ctx.fillStyle = g; ctx.fillRect(0, 0, canvas.width, canvas.height);

            const count = Math.min(60, 25 + (weather.cover / 2));
            for (let i = 0; i < count; i++) {
                let x = (Math.sin(i * 0.45 + time * 0.1) * 150 + 150 + (Math.cos(dir) * weather.wind * time * 8) % 350) % 350 - 25;
                let y = (Math.cos(i * 0.82 + time * 0.12) * 90 + 90 + (Math.sin(dir) * weather.wind * time * 4) % 230) % 230 - 25;
                const size = 65 + Math.sin(time + i) * 25 + (weather.hum * 0.35);
                if (size < 1) continue;
                const rG = ctx.createRadialGradient(x, y, 0, x, y, size);
                rG.addColorStop(0, `rgba(255,255,255,${0.08 + weather.cover / 600})`); rG.addColorStop(1, 'transparent');
                ctx.fillStyle = rG; ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI * 2); ctx.fill();
            }

            cmpCtx.clearRect(0, 0, 45, 45); cmpCtx.strokeStyle = 'rgba(0,255,204,0.2)'; cmpCtx.beginPath(); cmpCtx.arc(22.5, 22.5, 18, 0, Math.PI * 2); cmpCtx.stroke();
            cmpCtx.strokeStyle = '#00ffcc'; const ax = 22.5 + Math.cos(dir - Math.PI / 2) * 14, ay = 22.5 + Math.sin(dir - Math.PI / 2) * 14;
            cmpCtx.lineWidth = 2; cmpCtx.beginPath(); cmpCtx.moveTo(22.5, 22.5); cmpCtx.lineTo(ax, ay); cmpCtx.stroke();
            cmpCtx.fillStyle = '#00ffcc'; cmpCtx.beginPath(); cmpCtx.arc(ax, ay, 3, 0, Math.PI * 2); cmpCtx.fill();
        }

        async function updateWeather(city = cities[0]) {
            try {
                log(`LINK: ${city.name.toUpperCase()}`);
                const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,relative_humidity_2m,cloud_cover,cloud_cover_low,cloud_cover_mid,cloud_cover_high,wind_speed_10m,wind_direction_10m`);
                const d = await r.json(); const c = d.current;
                weather = { cover: c.cloud_cover, low: c.cloud_cover_low, mid: c.cloud_cover_mid, high: c.cloud_cover_high, hum: c.relative_humidity_2m, wind: c.wind_speed_10m, dir: c.wind_direction_10m };

                document.getElementById('cityName').textContent = city.name;
                document.getElementById('temp').textContent = c.temperature_2m;
                document.getElementById('hum').textContent = c.relative_humidity_2m;
                document.getElementById('windSpd').textContent = c.wind_speed_10m;
                document.getElementById('coverLow').style.width = c.cloud_cover_low + '%';
                document.getElementById('coverMid').style.width = c.cloud_cover_mid + '%';
                document.getElementById('coverHigh').style.width = c.cloud_cover_high + '%';

                updateAnalysis();
                log(`SYNC SUCCESS.`);
            } catch (e) { log("OFFLINE"); }
        }

        function updateAnalysis() {
            const status = document.getElementById('status-text');
            const alert = document.getElementById('alert-banner');
            alert.style.display = 'none';

            let analysis = "";
            if (weather.wind > 15) {
                analysis = "КРИТИЧНА ШВИДКІСТЬ ВІТРУ. Висока турбулентність. Рекомендується стабілізація зондів.";
                alert.textContent = "!! УВАГА: ШТОРМОВИЙ ВІТЕР !!"; alert.style.display = 'block';
            } else if (weather.cover > 85) {
                analysis = "ЩІЛЬНИЙ ХМАРНИЙ ШАР. Обмежена видимість для оптичних інструментів.";
                alert.textContent = "!! ОБМЕЖЕНА ВИДИМІСТЬ !!"; alert.style.display = 'block';
                alert.style.borderColor = "#ffcc00"; alert.style.color = "#ffcc00"; alert.style.background = "rgba(255,204,0,0.1)";
            } else {
                analysis = "ПОМІРНА АТМОСФЕРНА АКТИВНІСТЬ. Всі системи працюють у штатному режимі.";
            }
            status.textContent = analysis;
        }

        function log(m) {
            const l = document.getElementById('sys-log');
            const d = document.createElement('div'); d.textContent = `> ${m}`;
            l.prepend(d); if (l.childNodes.length > 5) l.removeChild(l.lastChild);
        }

        function loop(t) { draw(t); requestAnimationFrame(loop); }
        updateWeather(); requestAnimationFrame(loop);
    </script>
</body>

</html>
