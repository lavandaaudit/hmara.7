<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IBONARIUM · DEEP ATMOS ANALYTICS · PRO 2026</title>
    <style>
        :root {
            --bg: #05080a;
            --accent: #00ffcc;
            --secondary: #00ccff;
            --danger: #ff3366;
            --warning: #ffcc00;
            --glass: rgba(10, 20, 30, 0.95);
            --border: rgba(0, 255, 204, 0.3);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background: #000;
            color: #d0f0ff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            min-height: 100vh;
        }

        #bg-canvas {
            position: fixed;
            inset: 0;
            z-index: 1;
        }

        /* CENTRAL DASHBOARD (CENTERED & -10% SCALE) */
        #ui-dock {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            z-index: 100;
            padding: 20px;
            pointer-events: none;
            width: max-content;
            max-width: 100vw;
        }

        #cloud-barometer {
            width: 310px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 14px;
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            padding: 15px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.9);
            pointer-events: auto;
        }

        #data-projection {
            flex: 1;
            max-width: 1000px;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .proj-section {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .proj-item {
            display: flex;
            flex-direction: column;
        }

        .proj-label {
            font-size: 8px;
            color: var(--accent);
            letter-spacing: 1.5px;
            opacity: 0.5;
            margin-bottom: 2px;
            text-transform: uppercase;
        }

        .proj-value {
            font-size: 16px;
            color: #fff;
            font-weight: bold;
        }

        .proj-value span {
            font-size: 9px;
            opacity: 0.4;
            font-weight: normal;
            margin-left: 2px;
        }

        .inst-header {
            font-size: 10px;
            letter-spacing: 3px;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 12px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 6px;
            text-align: center;
            font-weight: bold;
        }

        #alert-zone {
            min-height: 20px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .alert-item {
            background: rgba(255, 51, 102, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            font-size: 8px;
            padding: 4px;
            border-radius: 3px;
            text-align: center;
            animation: pulse-alert 2s infinite;
        }

        .alert-item.warning {
            background: rgba(255, 204, 0, 0.1);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        @keyframes pulse-alert {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .viz-container {
            width: 100%;
            height: 240px;
            background: #030608;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 12px;
            position: relative;
            border: 1px solid rgba(0, 255, 204, 0.1);
        }

        #scientific-desc {
            margin-top: 10px;
            font-size: 10px;
            line-height: 1.6;
            color: #6fffa0;
            border-left: 1px solid var(--accent);
            padding-left: 15px;
            text-align: justify;
        }

        .city-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px;
            margin-top: 10px;
        }

        .city-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--accent);
            font-size: 7.5px;
            padding: 4px 1px;
            cursor: pointer;
            border-radius: 3px;
            text-align: center;
            pointer-events: auto;
            white-space: nowrap;
        }

        .city-btn.active {
            background: var(--accent);
            color: #000;
        }

        #sys-log {
            font-size: 7px;
            color: var(--accent);
            opacity: 0.5;
            height: 35px;
            margin-top: 10px;
            display: flex;
            flex-direction: column-reverse;
            overflow: hidden;
            border-top: 1px solid var(--border);
            padding-top: 5px;
        }

        .proj-title-big {
            font-size: 32px;
            letter-spacing: 12px;
            color: var(--accent);
            opacity: 0.3;
            text-align: center;
            margin-top: 10px;
            width: 100%;
        }

        .mini-compass {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 45px;
            height: 45px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <canvas id="bg-canvas"></canvas>

    <div id="ui-dock">
        <!-- БАРОМЕТР (ЗЛІВА В ДОЦІ) -->
        <div id="cloud-barometer">
            <div class="inst-header">IBONARIUM · ATMOS ANALYST</div>
            <div id="alert-zone"></div>
            <div class="viz-container">
                <canvas id="cloud-engine"></canvas>
                <canvas id="mini-compass" class="mini-compass"></canvas>
            </div>
            <div class="data-grid">
                <div class="data-box"><label>ЛОКАЦІЯ</label><b id="cityName">---</b></div>
                <div class="data-box"><label>ТЕМПЕРАТУРА</label><b id="temp">--</b>°C</div>
                <div class="data-box"><label>ВОЛОГІСТЬ</label><b id="hum">--</b>%</div>
                <div class="data-box"><label>ВІТЕР</label><b id="windSpd">--</b> м/с</div>
            </div>
            <div class="city-grid" id="cityContainer"></div>
            <div id="sys-log"></div>
        </div>

        <!-- АНАЛІТИКА (СПРАВА В ДОЦІ) -->
        <div id="data-projection">
            <div class="proj-section">
                <div class="proj-item">
                    <div class="proj-label">ВІДЧУВАЄТЬСЯ</div>
                    <div class="proj-value" id="app-temp">--°<span>C</span></div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">УФ ІНДЕКС</div>
                    <div class="proj-value" id="uv-idx">--<span>LVL</span></div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">ТИСК</div>
                    <div class="proj-value" id="pressure">--<span>hPa</span></div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">ТОЧКА РОСИ</div>
                    <div class="proj-value" id="dew-point">--°<span>C</span></div>
                </div>
            </div>
            <div class="proj-section">
                <div class="proj-item">
                    <div class="proj-label">ВИДИМІСТЬ</div>
                    <div class="proj-value" id="visib">--<span>км</span></div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">СОНЯЧНА РАДІАЦІЯ</div>
                    <div class="proj-value" id="radiation">--<span>W/m²</span></div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">ПОРИВИ ВІТРУ</div>
                    <div class="proj-value" id="gusts">--<span>м/с</span></div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">ХМАРНІСТЬ (НИЗ)</div>
                    <div class="proj-value" id="c-low">--<span>%</span></div>
                </div>
            </div>
            <div class="proj-section">
                <div class="proj-item">
                    <div class="proj-label">ҐРУНТОВА ВОЛОГА</div>
                    <div class="proj-value" id="soil-m">--<span>m³/m³</span></div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">СХІД СОНЦЯ</div>
                    <div class="proj-value" id="sunrise">--:--</div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">ЗАХІД СОНЦЯ</div>
                    <div class="proj-value" id="sunset">--:--</div>
                </div>
                <div class="proj-item">
                    <div class="proj-label">ОПАДИ (1 ГОД)</div>
                    <div class="proj-value" id="precip">0.0<span>мм</span></div>
                </div>
            </div>

            <div id="scientific-desc">
                <b style="color:var(--accent); font-size: 11px;">[ ГЛИБОКИЙ ТЕРМОДИНАМІЧНИЙ АНАЛІЗ ]</b><br><br>
                <span id="detailed-desc">Очікування потоку даних...</span>
            </div>

            <div class="proj-title-big" id="cityBigName">---</div>
        </div>
    </div>

    <script>
        const cities = [
            { name: "Київ", lat: 50.45, lon: 30.52 }, { name: "Харків", lat: 49.99, lon: 36.23 }, { name: "Львів", lat: 49.83, lon: 24.02 }, { name: "Одеса", lat: 46.48, lon: 30.72 },
            { name: "Дніпро", lat: 48.46, lon: 35.04 }, { name: "Нью Йорк", lat: 40.71, lon: -74.01 }, { name: "Лондон", lat: 51.51, lon: -0.13 }, { name: "Париж", lat: 48.85, lon: 2.35 },
            { name: "Б. Айрес", lat: -34.61, lon: -58.38 }, { name: "Дубай", lat: 25.20, lon: 55.27 }, { name: "Токіо", lat: 35.68, lon: 139.69 }, { name: "Сінгапур", lat: 1.35, lon: 103.81 },
            { name: "Рим", lat: 41.90, lon: 12.49 }, { name: "Берлін", lat: 52.52, lon: 13.40 }, { name: "Сідней", lat: -33.86, lon: 151.20 }, { name: "Каїр", lat: 30.04, lon: 31.23 },
            { name: "Відень", lat: 48.20, lon: 16.37 }, { name: "Пекін", lat: 39.90, lon: 116.40 }, { name: "Лагос", lat: 6.52, lon: 3.37 }, { name: "Л. Анджелес", lat: 34.05, lon: -118.24 }
        ];

        let weather = { cover: 0, low: 0, mid: 0, high: 0, hum: 50, wind: 0, dir: 0 };
        const cityBox = document.getElementById('cityContainer');
        cities.forEach((c, i) => {
            const btn = document.createElement('div');
            btn.className = 'city-btn' + (i === 0 ? ' active' : '');
            btn.textContent = c.name;
            btn.onclick = () => {
                document.querySelectorAll('.city-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updateWeather(c);
            };
            cityBox.appendChild(btn);
        });

        const canvas = document.getElementById('cloud-engine');
        const ctx = canvas.getContext('2d');
        const cmpCanvas = document.getElementById('mini-compass');
        const cmpCtx = cmpCanvas.getContext('2d');
        const bgCanvas = document.getElementById('bg-canvas');
        const bgCtx = bgCanvas.getContext('2d');

        const stars = Array.from({ length: 400 }, () => ({ x: Math.random(), y: Math.random(), s: Math.random() * 1.5, o: Math.random() }));

        function resize() {
            canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight;
            cmpCanvas.width = 45; cmpCanvas.height = 45;
            bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight;
        }
        window.onresize = resize; resize();

        function drawStars(t) {
            bgCtx.fillStyle = '#000'; bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);
            stars.forEach(s => {
                bgCtx.fillStyle = `rgba(255, 255, 255, ${0.15 + (Math.sin(t * 0.001 + s.o * 8) * 0.45)})`;
                bgCtx.fillRect(s.x * bgCanvas.width, s.y * bgCanvas.height, s.s, s.s);
            });
        }

        function drawViz(t) {
            if (!canvas.width) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const time = t * 0.0006, dir = (weather.dir || 0) * Math.PI / 180;
            const g = ctx.createLinearGradient(0, 0, 0, canvas.height);
            g.addColorStop(0, '#0a1a20'); g.addColorStop(1, '#000');
            ctx.fillStyle = g; ctx.fillRect(0, 0, canvas.width, canvas.height);
            const count = Math.min(60, 25 + (weather.cover / 2));
            for (let i = 0; i < count; i++) {
                let x = (Math.sin(i * 0.45 + time * 0.1) * 150 + 150 + (Math.cos(dir) * (weather.wind || 0) * time * 5) % 350) % 350 - 25;
                let y = (Math.cos(i * 0.82 + time * 0.12) * 90 + 90 + (Math.sin(dir) * (weather.wind || 0) * time * 3) % 230) % 230 - 25;
                const size = 60 + Math.sin(time + i) * 20 + (weather.hum * 0.35);
                const rG = ctx.createRadialGradient(x, y, 0, x, y, size);
                rG.addColorStop(0, `rgba(255,255,255,${0.04 + weather.cover / 900})`); rG.addColorStop(1, 'transparent');
                ctx.fillStyle = rG; ctx.beginPath(); ctx.arc(x, y, size, 0, Math.PI * 2); ctx.fill();
            }
            cmpCtx.clearRect(0, 0, 45, 45); cmpCtx.strokeStyle = 'rgba(0,255,204,0.15)'; cmpCtx.beginPath(); cmpCtx.arc(22.5, 22.5, 18, 0, Math.PI * 2); cmpCtx.stroke();
            cmpCtx.strokeStyle = '#00ffcc'; const ax = 22.5 + Math.cos(dir - Math.PI / 2) * 14, ay = 22.5 + Math.sin(dir - Math.PI / 2) * 14;
            cmpCtx.lineWidth = 2; cmpCtx.beginPath(); cmpCtx.moveTo(22.5, 22.5); cmpCtx.lineTo(ax, ay); cmpCtx.stroke();
            cmpCtx.fillStyle = '#00ffcc'; cmpCtx.beginPath(); cmpCtx.arc(ax, ay, 3, 0, Math.PI * 2); cmpCtx.fill();
        }

        async function updateWeather(city = cities[0]) {
            try {
                log(`SYNC: ${city.name.toUpperCase()}`);
                const r = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,cloud_cover,cloud_cover_low,cloud_cover_mid,cloud_cover_high,surface_pressure,wind_speed_10m,wind_direction_10m,wind_gusts_10m,uv_index,shortwave_radiation,visibility,dew_point_2m,soil_moisture_0_to_1cm&hourly=temperature_2m,surface_pressure,relative_humidity_2m&daily=sunrise,sunset&timezone=auto`);
                const d = await r.json(); const c = d.current;

                weather = { cover: c.cloud_cover, hum: c.relative_humidity_2m, wind: c.wind_speed_10m, dir: c.wind_direction_10m };

                document.getElementById('cityName').textContent = city.name;
                document.getElementById('cityBigName').textContent = city.name.toUpperCase();
                document.getElementById('temp').textContent = c.temperature_2m;
                document.getElementById('hum').textContent = c.relative_humidity_2m;
                document.getElementById('windSpd').textContent = c.wind_speed_10m;

                document.getElementById('app-temp').innerHTML = `${c.apparent_temperature}°<span>C</span>`;
                document.getElementById('uv-idx').innerHTML = `${c.uv_index || 0}<span>LVL</span>`;
                document.getElementById('pressure').innerHTML = `${c.surface_pressure}<span>hPa</span>`;
                document.getElementById('dew-point').innerHTML = `${c.dew_point_2m}°<span>C</span>`;
                document.getElementById('visib').innerHTML = `${(c.visibility / 1000).toFixed(1)}<span>км</span>`;
                document.getElementById('radiation').innerHTML = `${c.shortwave_radiation.toFixed(0)}<span>W/m²</span>`;
                document.getElementById('gusts').innerHTML = `${c.wind_gusts_10m.toFixed(1)}<span>м/с</span>`;
                document.getElementById('c-low').innerHTML = `${c.cloud_cover_low}<span>%</span>`;
                document.getElementById('soil-m').innerHTML = `${c.soil_moisture_0_to_1cm ? c.soil_moisture_0_to_1cm.toFixed(3) : '---'}<span>m³/m³</span>`;
                document.getElementById('precip').innerHTML = `${c.precipitation.toFixed(1)}<span>мм</span>`;

                const timeOpts = { hour: '2-digit', minute: '2-digit' };
                document.getElementById('sunrise').textContent = new Date(d.daily.sunrise[0]).toLocaleTimeString('uk-UA', timeOpts);
                document.getElementById('sunset').textContent = new Date(d.daily.sunset[0]).toLocaleTimeString('uk-UA', timeOpts);

                // Calculate Deltas from Hourly Data
                const hourIdx = new Date().getHours();
                const deltaP = (d.hourly.surface_pressure[hourIdx] - d.hourly.surface_pressure[hourIdx - 1]).toFixed(2);
                const deltaT = (d.hourly.temperature_2m[hourIdx] - d.hourly.temperature_2m[hourIdx - 1]).toFixed(2);

                generateDetailedDescription(c, city.name, deltaP, deltaT);
                updateAnalysis(c, deltaP, deltaT);
                log(`SYNC SUCCESS.`);
            } catch (e) { log("ERR: OFFLINE"); console.error(e); }
        }

        const weatherMap = {
            0: "СТАН: Ясне небо. Втрата тепла через випромінювання максимальна.",
            1: "СТАН: Переважно ясно. Незначна адвекція хмарних мас.",
            2: "СТАН: Мінлива хмарність. Мозаїчна структура сонячної радіації.",
            3: "СТАН: Суцільна хмарність. Високе альбедо атмосфери.",
            45: "СТАН: Радіаційний туман. Критичне зниження індексу вертикальної видимості.",
            51: "СТАН: Легка мряка. Насичення приземного шару повітря вологою.",
            61: "СТАН: Слабкий дощ. Процес вимивання аерозолів з атмосфери.",
            71: "СТАН: Тверді опади. Перехід фазового стану води в кристалічну форму.",
            80: "СТАН: Локальні зливи. Активна конвекція та теплообмін.",
            95: "СТАН: Грозова активність. Масштабна іонізація та кумулонібусна експансія."
        };

        function updateAnalysis(c, deltaP, deltaT) {
            const zone = document.getElementById('alert-zone');
            const status = document.getElementById('status-text'); // actually used in desc, but we can set a sum status
            zone.innerHTML = '';

            const alerts = [];
            if (c.wind_speed_10m > 15) alerts.push({ text: "!! КРИТИЧНИЙ ВІТЕР !!", type: 'danger' });
            if (c.wind_gusts_10m > 20) alerts.push({ text: "!! ШТОРМОВІ ПОРИВИ !!", type: 'danger' });
            if (deltaP < -1.5) alerts.push({ text: "!! СТРІМКЕ ПАДІННЯ ТИСКУ !!", type: 'danger' });
            if (c.uv_index > 6) alerts.push({ text: "!! ВИСОКА УФ-РАДІАЦІЯ !!", type: 'warning' });
            if (c.visibility < 1000) alerts.push({ text: "!! КРИТИЧНИЙ ТУМАН !!", type: 'warning' });
            if (c.shortwave_radiation > 800) alerts.push({ text: "!! ПІКОВА СОНЯЧНА ЕНЕРГІЯ !!", type: 'warning' });
            if (Math.abs(deltaT) > 3) alerts.push({ text: "!! ТЕРМІЧНИЙ ШОК МАСИ !!", type: 'warning' });

            alerts.forEach(a => {
                const div = document.createElement('div');
                div.className = `alert-item ${a.type === 'warning' ? 'warning' : ''}`;
                div.textContent = a.text;
                zone.appendChild(div);
            });

            if (alerts.length === 0) {
                const div = document.createElement('div');
                div.className = "alert-item warning";
                div.style.background = "rgba(0, 255, 204, 0.05)";
                div.style.borderColor = "var(--border)";
                div.style.color = "var(--accent)";
                div.style.animation = "none";
                div.textContent = "> СИСТЕМА СТАБІЛЬНА";
                zone.appendChild(div);
            }
        }

        function generateDetailedDescription(c, cityName, deltaP, deltaT) {
            const code = c.weather_code;
            const desc = weatherMap[code] || "Стабільний стан атмосферного фронту.";

            let report = `[ АНАЛІТИЧНИЙ ЗВІТ ДЛЯ ЛОКАЦІЇ: ${cityName.toUpperCase()} ]\n\n`;
            report += `ДИНАМІКА ТА СТАН: ${desc}\n\n`;

            report += `[ ТРЕНДИ ТА ВЕКТОР ЗМІН ]\n`;
            report += `БАРІЧНИЙ ТРЕНД: ${deltaP > 0 ? "Зростання" : "Падіння"} тиску на ${Math.abs(deltaP)} hPa/год. `;
            report += deltaP < -1.5 ? "УВАГА: Стрімке падіння тиску сигналізує про наближення циклону або шторму.\n" : (deltaP > 1.5 ? "Стрімке зростання тиску, стабілізація антициклону.\n" : "Баричне поле відносно стабільне.\n");

            report += `ТЕРМІЧНИЙ ВЕКТОР: ${deltaT > 0 ? "Нагрівання" : "Охолодження"} повітряної маси (${deltaT > 0 ? "+" : ""}${deltaT} °C/год). `;
            report += Math.abs(deltaT) > 2 ? "Зафіксовано різку зміну температурного градієнта.\n\n" : "Температурна динаміка в межах норми.\n\n";

            report += `[ ТЕРМОДИНАМІЧНИЙ ПРОФІЛЬ ]\n`;
            report += `Поточний режим ${c.temperature_2m}°C при вологості ${c.relative_humidity_2m}% створює точку роси на рівні ${c.dew_point_2m}°C. `;
            report += `Відчутна температура ${c.apparent_temperature}°C коригується відповідно до швидкості вітру та радіаційного фону.\n\n`;

            report += `[ КІНЕТИКА ТА ЕНЕРГЕТИКА ]\n`;
            report += `Швидкість потоку: ${c.wind_speed_10m} м/с. `;
            if (c.wind_gusts_10m > (c.wind_speed_10m * 1.5)) {
                report += `Аномальні пориви до ${c.wind_gusts_10m} м/с свідчать про активну турбулентність та енергетичний обмін у приземному шарі. `;
            }
            report += `Сонячна радіація: ${c.shortwave_radiation.toFixed(0)} W/m².\n\n`;

            report += `[ ГІДРОЛОГІЯ ТА КОНДЕНСАЦІЯ ]\n`;
            report += `Хмарність нижнього ярусу: ${c.cloud_cover_low}%. `;
            if (c.precipitation > 0) {
                report += `Інтенсивність опадів: ${c.precipitation.toFixed(1)} мм/год. Рівень вологи ґрунту: ${c.soil_moisture_0_to_1cm ? c.soil_moisture_0_to_1cm.toFixed(3) : 'н/д'} m³/m³.`;
            } else {
                report += "Опадів не зафіксовано. Гідрологічний індекс стабільний.";
            }

            document.getElementById('detailed-desc').innerText = report;
        }

        function log(m) {
            const l = document.getElementById('sys-log');
            const d = document.createElement('div'); d.textContent = `> ${new Date().toLocaleTimeString()} : ${m}`;
            l.prepend(d); if (l.childNodes.length > 3) l.removeChild(l.lastChild);
        }

        function loop(t) { drawStars(t); drawViz(t); requestAnimationFrame(loop); }
        updateWeather(); requestAnimationFrame(loop);
    </script>
</body>

</html>
